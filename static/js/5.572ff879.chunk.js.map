{"version":3,"sources":["common/Secondhead/index.js","components/Headportrait/SelectProfilePic.js","components/Headportrait/index.js","components/Perfectinformation/Questions.js","components/Perfectinformation/index.js"],"names":["Secondhead","className","href","this","props","title","buyUrl","target","rel","type","theme","buyBtn","Component","SelectProfilePic","withTranslation","image","React","createRef","state","myCropper","afterImg","Cropper","current","viewMode","dragMode","initialAspectRatio","aspectRatio","preview","background","autoCropArea","zoomOnWheel","setState","replace","img","t","confirm","cancel","src","ref","alt","onClick","Headportrait","handleChange","e","files","length","file","size","message","error","i18next","callback","reader","FileReader","addEventListener","result","readAsDataURL","getBase64","imageUrl","handleCancel","handleconfirm","cropper","key","loading","content","duration","afterimg","getCroppedCanvas","imageSmoothingQuality","toDataURL","wordArray","CryptoJS","lib","WordArray","create","hash","SHA256","toString","blob","dataURLtoBlob","ajaxPromise","host","getCookie","name","then","wsget","id","res","success","catch","imageRef","value","accept","onChange","Questions","form","setFieldsValue","text","val","visible","onCancel","onCreate","getFieldDecorator","okText","onOk","getContainer","Item","label","rules","required","whitespace","max","autoComplete","placeholder","Option","Perfectinformation","inject","withRouter","observer","show","nativeEvent","stopImmediatePropagation","pro_visible","fiag","setCustom","custom","checkId","setTimeout","customRef","focus","input_focus","txt","input_blur","headporId","a","event","emit","handleSubmit","preventDefault","validateFieldsAndScroll","err","values","data","nickname","trim","email","pwd_question","question","pwd_answer","answer","profile_id","login","info_login","user","storage","get","pwd","login_in","history","push","handleCreate","formRef","validateFields","resetFields","saveFormRef","getAvatar","user_id","addItem","getFieldValue","questionVal","AnswerValidity","rule","taskStr","check_email","nameRef","emailRef","answerRef","head_visible","problemList","userdata","match","params","Number","remove","avatar","on","rm","stopPropagation","idx","findIndex","el","problem","check_e","hasFeedback","validateStatus","icon","layout","onSubmit","placement","overlayClassName","trigger","pattern","reg","maxLength","onBlur","dropdownRender","menu","style","margin","padding","cursor","onMouseDown","map","item","htmlType","wrappedComponentRef"],"mappings":"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","file":"static/js/5.572ff879.chunk.js","sourcesContent":["import React, { Component } from 'react';\nimport { Icon } from 'antd';\nimport './style.scss';\nimport Languageselect from '../Languageselect';\nimport { buyUrl } from '../../util/url'\n\nexport default class Secondhead extends Component {\n  render() {\n    return (\n      <div className=\"second-header\">\n        <div className='logo'>\n          <h1>\n            <a href=\"/\">Lovcube</a>\n          </h1>\n        </div>\n        <div className='title'>\n          <p>{this.props.title}</p>\n        </div>\n        <div className='second-header-right clearfix'>\n          <div className='language-inner'>\n            <Languageselect />\n          </div>\n          {buyUrl ? <div className='buy-btn'>\n            <a href={buyUrl} target=\"_blank\" rel=\"noopener noreferrer\"><Icon type=\"picture\" theme=\"filled\" />{this.props.buyBtn}</a>\n          </div>: null}\n        </div>\n      </div>\n    );\n  }\n}\n","import React from 'react';\nimport Cropper from 'cropperjs'\nimport { withTranslation } from 'react-i18next';\nimport 'cropperjs/dist/cropper.css'\n\n@withTranslation()\nclass SelectProfilePic extends React.Component {\n  constructor(props) {\n    super(props);\n    this.image = React.createRef();\n    this.state = {\n      myCropper: null,\n      afterImg: ''\n    }\n  }\n\n  componentDidMount() {\n    let myCropper = new Cropper(this.image.current, {\n      viewMode: 1,\n      dragMode: 'none',\n      initialAspectRatio: 1,\n      aspectRatio: 1,\n      preview: '.before',\n      background: false,\n      autoCropArea: 0.6,\n      zoomOnWheel: false,\n    })\n    this.setState({\n      myCropper\n    }, () => {\n      this.state.myCropper.replace(this.props.img)\n    })\n  }\n\n  UNSAFE_componentWillReceiveProps(props) {\n    const { img } = props;\n    if (this.props.img !== img) {\n      this.state.myCropper.replace(img)\n    }\n  }\n  render() {\n    const { t, confirm, cancel } = this.props\n    return (\n      <div className='preview_picture'>\n        <div className='preview_left'>\n          <div className=\"show-img\">\n            <img src={this.props.img} ref={this.image} alt=\"\" />\n          </div>\n          <div className='preview_btn'>\n            <span className='confirm' onClick={() => { confirm(this.state.myCropper) }}>{t('Determine')}</span>\n            <span className='cancel' onClick={cancel}>{t('Cancel')}</span>\n          </div>\n        </div>\n        <div className='preview_right'>\n          <p>{t('imagePreview')}</p>\n          <div className=\"before\"></div>\n        </div>\n      </div>\n    );\n  }\n}\n\nexport default SelectProfilePic;","import React from 'react';\nimport CryptoJS from 'crypto-js';\nimport { Icon, message } from 'antd';\nimport { withTranslation } from 'react-i18next';\nimport i18next from 'i18next';\nimport { wsget, host } from '../../ws';\nimport { ajaxPromise, dataURLtoBlob, getCookie } from '../../util/util';\nimport './style.scss';\nimport SelectProfilePic from './SelectProfilePic';\n\nfunction getBase64(img, callback) {\n  const reader = new FileReader();\n  reader.addEventListener('load', () => callback(reader.result));\n  reader.readAsDataURL(img);\n}\n\n@withTranslation()\nclass Headportrait extends React.Component {\n  constructor(props) {\n    super(props);\n    this.imageRef = React.createRef();\n    this.state = {\n      imageUrl: null\n    }\n  }\n\n  handleChange = (e) => {\n    if (e.target.files.length > 0) {\n      let file = e.target.files[0];\n      if (file.size / 1024 / 1024 > 3) {\n        message.error(i18next.t('Picsize'))\n        return;\n      }\n      getBase64(file, (imageUrl) => {\n        this.setState({ imageUrl, file })\n      })\n    }\n  }\n\n  handleCancel = () => {\n    this.props.handleCancel()\n  }\n\n  handleconfirm = (cropper) => {\n    this.props.handleCancel();\n    const key = 'portrait';\n    message.loading({ content: 'uploading...', key, duration: 0 });\n    const { file } = this.state\n    let afterimg = cropper.getCroppedCanvas({\n      imageSmoothingQuality: 'high'\n    }).toDataURL('image/jpeg');\n    let wordArray = CryptoJS.lib.WordArray.create(afterimg);\n    const hash = CryptoJS.SHA256(wordArray).toString();\n    let blob = dataURLtoBlob(afterimg);\n    ajaxPromise(blob, `${host()}/up/p/${getCookie('cookie')}/${hash}/${file.name}`)\n      .then((result) => {\n        wsget('user_profile_id_save', result.id).then((res) => {\n          message.success({ content: 'succeed!', key, duration: 2 });\n          this.props.callback(null, result.id);\n        }).catch(() => {\n          message.error({ content: 'come to nothing', key, duration: 3 })\n        })\n      })\n  }\n\n  render() {\n    const { imageUrl } = this.state;\n    const { t, handleCancel } = this.props;\n\n    return (\n      <div className='Headportrait-wrap'>\n        <div className='Modify_the_picture'>\n          <span className='close-icon' onClick={handleCancel}>\n            <Icon type=\"close\" />\n          </span>\n          <div className='Modify_head'>\n            {t('Headimage')}\n          </div>\n          <div className='Modify_content'>\n            <p>{t('uploadavatar')}</p>\n            <div className=\"Modify_openimg\">\n              <input type=\"button\" className=\"pass-portrait-filebtn\" name=\"openImgBtn\" id=\"openImgBtn\" value={t('Choosepicture')} />\n              <input\n                type=\"file\"\n                className=\"pass-portrait-file\"\n                accept=\"image/bmp,image/jpeg,image/png\"\n                name=\"file\" id=\"fileImg\"\n                onChange={(e) => { this.handleChange(e) }} />\n              <span className=\"pass-portrait-msg\">{t('SupportPic')}</span>\n            </div>\n\n            {imageUrl && <SelectProfilePic\n              img={this.state.imageUrl}\n              confirm={this.handleconfirm}\n              cancel={this.handleCancel} />}\n\n          </div>\n        </div >\n      </div>\n    );\n  }\n}\nexport default Headportrait;","import React, { Component } from 'react';\nimport { withTranslation } from 'react-i18next';\nimport { Modal, Form, Input } from 'antd';\n\n@withTranslation()\n@Form.create({ name: 'questions' })\nclass Questions extends Component {\n  componentDidMount(){\n    this.props.form.setFieldsValue({\n      text: this.props.val\n    })\n  }\n\n  render() {\n    const { visible, onCancel, onCreate, form, t } = this.props;\n    const { getFieldDecorator } = form;\n    return (\n      <Modal\n        visible={visible}\n        title={t('CustomQuestions')}\n        okText={t('Determine')}\n        onOk={onCreate}\n        onCancel={onCancel}\n        getContainer={false}\n      >\n        <Form.Item label={t(\"securityQuestion\")}>\n            {getFieldDecorator('text', {\n              rules: [\n                { required: true, message: t('enterQuestion'), whitespace: true },\n                { max: 100, message: t('Notmorechar') }\n              ],\n            })(<Input\n              autoComplete=\"off\"\n              placeholder={t('enterQuestion')} />)}\n        </Form.Item>\n      </Modal>\n    );\n  }\n}\n\nexport default Questions;","import React, { Component } from 'react';\nimport { withRouter } from 'react-router-dom';\nimport { Tooltip, message, Icon } from 'antd';\nimport { Form, Input, Select, Button, Avatar, Divider } from 'antd';\nimport { withTranslation } from 'react-i18next';\nimport { inject, observer } from 'mobx-react';\nimport './style.scss'\nimport { trim, taskStr, storage, reg } from '../../util/util';\nimport { host, wsget } from '../../ws';\nimport Headportrait from '../Headportrait';\nimport Secondhead from '../../common/Secondhead';\nimport Questions from './Questions';\nimport event from '../../util/event';\n\nconst { Option } = Select;\n\n@withTranslation()\n@Form.create({ name: 'perfectinformation' })\n@withRouter\n@inject('login', 'playlist', 'rahmen', 'photoalbum')\n@observer\nclass Perfectinformation extends Component {\n  constructor(props) {\n    super(props);\n    this.nameRef = React.createRef();\n    this.emailRef = React.createRef();\n    this.answerRef = React.createRef();\n    this.customRef = React.createRef();\n    this.t = this.props.t;\n    this.state = {\n      head_visible: false,\n      problemList: [\n        { id: 1, text: this.t('birthday') },\n        { id: 2, text: this.t('yourmind') },\n        { id: 3, text: this.t('favoriteperson') }\n      ],\n      focus: null,\n      profile_id: null,\n      fiag: false,\n      visible: false,\n      user_id: null,\n      show: false,\n      questionVal: ''\n    }\n  }\n\n  componentDidMount() {\n    const userdata = storage.get('user');\n    const { id } = this.props.match.params;\n    if (Number(id) === userdata.id) {\n      this.setState({ user_id: id })\n    } else {\n      storage.remove('user');\n      this.props.history.push(\"/login\");\n    }\n\n    this.avatar = event.on('avatar', (id) => {\n      this.setState({ profile_id: id })\n    })\n  }\n\n  componentWillUnmount() {\n    event.rm(this.avatar)\n  }\n\n  change(e, id) {\n    e.stopPropagation();\n    const { problemList } = this.state;\n    const idx = problemList.findIndex(el => el.id === id);\n    this.setState({ custom: false, checkId: id, problem: problemList[idx].text, pro_visible: false })\n  }\n\n  show = (e) => {\n    e.nativeEvent.stopImmediatePropagation();\n    this.setState({ pro_visible: true, fiag: true })\n  }\n\n  setCustom = (e) => {\n    // this.setState({custom: true})\n    this.setState({ custom: true, checkId: 0 })\n    setTimeout(() => {\n      this.customRef.current.focus();\n    }, 0);\n  }\n\n  input_focus = (e, txt) => {\n    e.nativeEvent.stopImmediatePropagation();\n    this.setState({ focus: txt })\n  }\n  input_blur = (e) => {\n    e.nativeEvent.stopImmediatePropagation();\n    this.setState({ focus: null })\n  }\n\n  headporId = (a, id) => {  //形参a,必须存在\n    event.emit('avatar', id)\n  }\n\n  handleSubmit = e => {\n    e.preventDefault();\n    this.props.form.validateFieldsAndScroll((err, values) => {\n      if (!err) {\n        let data = {\n          nickname: trim(values.nickname),\n          email: values.email,\n          pwd_question: values.question,\n          pwd_answer: values.answer\n        }\n        if (this.state.profile_id) {\n          data.profile_id = this.state.profile_id;\n        }\n        if (this.state.show) {\n          message.error(this.t('boundmail'))\n          return;\n        }\n\n        this.props.login.info_login(data, () => {\n          let user = storage.get('user');\n          const data = {\n            name: user.name,\n            pwd: user.pwd\n          }\n          this.props.login.login_in(data, () => {\n            this.props.history.push(\"/\");\n          })\n        })\n      }\n    });\n  };\n\n  handleCancel = () => {\n    this.setState({ visible: false });\n  };\n\n  handleCreate = () => {\n    const { form } = this.formRef.props;\n    form.validateFields((err, values) => {\n      if (err) {\n        return;\n      }\n      this.props.form.setFieldsValue({\n        question: trim(values.text)\n      })\n      form.resetFields();\n      this.setState({ visible: false });\n    });\n  };\n\n  saveFormRef = formRef => {\n    this.formRef = formRef;\n  };\n\n  getAvatar = () => {\n    return `${host()}/uf/s/${this.state.profile_id}/${this.state.user_id}`\n  }\n\n  addItem = () => {\n    const val = this.props.form.getFieldValue('question') || '';\n    this.setState({\n      questionVal: val,\n      visible: true,\n    });\n  }\n\n  AnswerValidity = (rule, value, callback) => {\n    if (value.length < 2) {\n      return callback(this.props.t('answerValidity'));\n    }\n    if (taskStr(value)) {\n      return callback();\n    }\n    callback(this.props.t('answerValidity'));\n  };\n\n  check_email = (e) => {\n    wsget('user_check_email', e.target.value).then((res) => {\n      this.setState({ show: true })\n    }).catch((res) => {\n      if (res.state === 2) {\n        this.setState({ show: false })\n      }\n    })\n  }\n\n  render() {\n    const { t } = this.props;\n    const { getFieldDecorator } = this.props.form;\n    const {\n      problemList,\n      show,\n      head_visible,\n      profile_id,\n      questionVal } = this.state;\n\n    const check_e = show ? {\n      hasFeedback: true,\n      validateStatus: 'error'\n    } : {};\n\n    return (\n      <div className='perfectinformation-content'>\n        <Secondhead\n          title={t('PerfectInfo')}\n          buyBtn={t('Buyingphotoframes')} />\n        <div className='perfectinformation-inner'>\n          <div className='perfectinformation-head'>\n            <h2>{t('PerfectInfo')}</h2>\n          </div>\n\n          <div className='info_Avatar'>\n            <span className='info_label'>{t('HeadPortrait')}</span>\n            <div className='profile_picture' onClick={() => { this.setState({ head_visible: true }) }}>\n              {profile_id ?\n                <img alt='profile' src={this.getAvatar()} /> :\n                <Avatar size={56} icon=\"user\" />}\n              <Icon className='right-rigth' type=\"right\" />\n            </div>\n          </div>\n\n          <Form layout=\"inline\" onSubmit={this.handleSubmit}>\n            <Form.Item label={t('Nickname')}>\n              <Tooltip\n                placement=\"topLeft\"\n                overlayClassName='tooltip'\n                trigger='focus'\n                title={t('regrule4')}>\n                {getFieldDecorator('nickname', {\n                  rules: [\n                    { required: true, message: t('NicknameEmpty'), whitespace: true },\n                    { pattern: reg.nickname, message: t('nicknameValidity') }\n                  ],\n                })(<Input\n                  autoComplete=\"off\"\n                  size=\"large\"\n                  maxLength={50}\n                  placeholder={t('SetNickname')} />)}\n              </Tooltip>\n            </Form.Item>\n            <Form.Item\n              label={t('mailbox')}\n              {...check_e}\n            >\n              {getFieldDecorator('email', {\n                rules: [\n                  {\n                    pattern: reg.email,\n                    message: 'The input is not valid E-mail!',\n                  },\n                  {\n                    required: true,\n                    message: t('MailboxEmpty'),\n                  }\n                ],\n              })(<Input onBlur={this.check_email} autoComplete=\"off\" size=\"large\" placeholder={t('SetMailbox')} />)}\n            </Form.Item>\n            <Form.Item label={t('securityQuestion')}>\n              {getFieldDecorator('question', {\n                rules: [\n                  {\n                    required: true,\n                    message: t('selectQuestion'),\n                  },\n                ],\n              })(\n                <Select\n                  size=\"large\"\n                  placeholder={t('selectQuestion')}\n                  dropdownRender={menu => (\n                    <div>\n                      {menu}\n                      <Divider style={{ margin: '4px 0' }} />\n                      <div\n                        className='custom-issue'\n                        style={{ padding: '4px 8px', cursor: 'pointer' }}\n                        onMouseDown={e => e.preventDefault()}\n                        onClick={this.addItem}\n                      >\n                        <Icon type=\"plus\" /> {t('CustomQuestions')}\n                      </div>\n                    </div>)}>\n                  {\n                    problemList.map(item => {\n                      return (\n                        <Option key={item.id} value={item.text}>{item.text}</Option>\n                      )\n                    })\n                  }\n                </Select>)}\n            </Form.Item>\n            <Form.Item label={t('Answer')}>\n              <Tooltip\n                placement=\"topLeft\"\n                overlayClassName='tooltip'\n                trigger='focus'\n                title={t('regrule6')}>\n                {getFieldDecorator('answer', {\n                  rules: [\n                    { required: true, message: t('enterAnswer'), whitespace: true }\n                  ],\n                })(<Input\n                  size=\"large\"\n                  maxLength={50}\n                  placeholder={t('enterAnswer')} />)}\n              </Tooltip>\n            </Form.Item>\n            <Form.Item>\n              <Button className='confirm-btn' type=\"primary\" htmlType=\"submit\">{t('Determine')}</Button>\n            </Form.Item>\n          </Form>\n          <span className='hint'>ps:{t('required')}</span>\n\n          {this.state.visible && <Questions\n            wrappedComponentRef={this.saveFormRef}\n            visible={this.state.visible}\n            onCancel={this.handleCancel}\n            onCreate={this.handleCreate}\n            val={questionVal}\n          />}\n        </div>\n\n        {head_visible && <Headportrait\n          callback={this.headporId}\n          handleCancel={() => { this.setState({ head_visible: false }) }} />}\n\n        <div className='l-top'></div>\n        <div className='l-bottom'></div>\n      </div >\n    );\n  }\n}\n\nexport default Perfectinformation;\n"],"sourceRoot":""}