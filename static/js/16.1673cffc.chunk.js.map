{"version":3,"sources":["common/Widget/Footer.js","components/Headportrait/SelectProfilePic.js","components/Headportrait/index.js","page/Personal/index.js"],"names":["Footer","id","className","i18next","t","SelectProfilePic","withTranslation","props","image","React","createRef","state","myCropper","afterImg","Cropper","this","current","viewMode","dragMode","initialAspectRatio","aspectRatio","preview","background","autoCropArea","zoomOnWheel","setState","replace","img","confirm","cancel","src","ref","alt","onClick","Component","Headportrait","handleChange","e","target","files","length","file","size","message","error","callback","reader","FileReader","addEventListener","result","readAsDataURL","getBase64","imageUrl","handleCancel","handleconfirm","cropper","key","loading","content","duration","afterimg","getCroppedCanvas","imageSmoothingQuality","toDataURL","wordArray","CryptoJS","lib","WordArray","create","hash","SHA256","toString","blob","dataURLtoBlob","ajaxPromise","host","getCookie","name","then","wsget","res","success","catch","imageRef","type","value","accept","onChange","Personal","inject","observer","chengeEmailHide","nodeName","emailVisible","nameVisible","changeName","nativeEvent","stopImmediatePropagation","user_detail","login","trim","nameRef","get","reg","nickname","test","getUser_detail","event","emit","data","firstInit","changeEmail","storage","email","emailRef","checkEmail","setEmail","set","showModule","visible","hideModal","preserve","old_pwd","old_pwdRef","new_pwd","new_pwdRef","user","pwd","oldpwd","newpwd","pwdVisible","upPortrait","a","pwdref","document","removeEventListener","placement","overlayClassName","trigger","title","style","display","spellCheck","maxLength","placeholder","readOnly","userId","htmlFor","observable"],"mappings":"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","file":"static/js/16.1673cffc.chunk.js","sourcesContent":["import React from 'react';\nimport i18next from 'i18next';\nimport './style.scss';\n\nfunction Footer() {\n  return (\n    <div id=\"Footer\">\n      <p className='foot-copyright'>{i18next.t('copyright')}</p>\n    </div>\n  );\n}\n\nexport default Footer;\n","import React from 'react';\nimport Cropper from 'cropperjs'\nimport { withTranslation } from 'react-i18next';\nimport 'cropperjs/dist/cropper.css'\n\n@withTranslation()\nclass SelectProfilePic extends React.Component {\n  constructor(props) {\n    super(props);\n    this.image = React.createRef();\n    this.state = {\n      myCropper: null,\n      afterImg: ''\n    }\n  }\n\n  componentDidMount() {\n    let myCropper = new Cropper(this.image.current, {\n      viewMode: 1,\n      dragMode: 'none',\n      initialAspectRatio: 1,\n      aspectRatio: 1,\n      preview: '.before',\n      background: false,\n      autoCropArea: 0.6,\n      zoomOnWheel: false,\n    })\n    this.setState({\n      myCropper\n    }, () => {\n      this.state.myCropper.replace(this.props.img)\n    })\n  }\n\n  UNSAFE_componentWillReceiveProps(props) {\n    const { img } = props;\n    if (this.props.img !== img) {\n      this.state.myCropper.replace(img)\n    }\n  }\n  render() {\n    const { t, confirm, cancel } = this.props\n    return (\n      <div className='preview_picture'>\n        <div className='preview_left'>\n          <div className=\"show-img\">\n            <img src={this.props.img} ref={this.image} alt=\"\" />\n          </div>\n          <div className='preview_btn'>\n            <span className='confirm' onClick={() => { confirm(this.state.myCropper) }}>{t('Determine')}</span>\n            <span className='cancel' onClick={cancel}>{t('Cancel')}</span>\n          </div>\n        </div>\n        <div className='preview_right'>\n          <p>{t('imagePreview')}</p>\n          <div className=\"before\"></div>\n        </div>\n      </div>\n    );\n  }\n}\n\nexport default SelectProfilePic;","import React from 'react';\nimport CryptoJS from 'crypto-js';\nimport { Icon, message } from 'antd';\nimport { withTranslation } from 'react-i18next';\nimport i18next from 'i18next';\nimport { wsget, host } from '../../ws';\nimport { ajaxPromise, dataURLtoBlob, getCookie } from '../../util/util';\nimport './style.scss';\nimport SelectProfilePic from './SelectProfilePic';\n\nfunction getBase64(img, callback) {\n  const reader = new FileReader();\n  reader.addEventListener('load', () => callback(reader.result));\n  reader.readAsDataURL(img);\n}\n\n@withTranslation()\nclass Headportrait extends React.Component {\n  constructor(props) {\n    super(props);\n    this.imageRef = React.createRef();\n    this.state = {\n      imageUrl: null\n    }\n  }\n\n  handleChange = (e) => {\n    if (e.target.files.length > 0) {\n      let file = e.target.files[0];\n      if (file.size / 1024 / 1024 > 3) {\n        message.error(i18next.t('Picsize'))\n        return;\n      }\n      getBase64(file, (imageUrl) => {\n        this.setState({ imageUrl, file })\n      })\n    }\n  }\n\n  handleCancel = () => {\n    this.props.handleCancel()\n  }\n\n  handleconfirm = (cropper) => {\n    this.props.handleCancel();\n    const key = 'portrait';\n    message.loading({ content: 'uploading...', key, duration: 0 });\n    const { file } = this.state\n    let afterimg = cropper.getCroppedCanvas({\n      imageSmoothingQuality: 'high'\n    }).toDataURL('image/jpeg');\n    let wordArray = CryptoJS.lib.WordArray.create(afterimg);\n    const hash = CryptoJS.SHA256(wordArray).toString();\n    let blob = dataURLtoBlob(afterimg);\n    ajaxPromise(blob, `${host()}/up/p/${getCookie('cookie')}/${hash}/${file.name}`)\n      .then((result) => {\n        wsget('user_profile_id_save', result.id).then((res) => {\n          message.success({ content: 'succeed!', key, duration: 2 });\n          this.props.callback(null, result.id);\n        }).catch(() => {\n          message.error({ content: 'come to nothing', key, duration: 3 })\n        })\n      })\n  }\n\n  render() {\n    const { imageUrl } = this.state;\n    const { t, handleCancel } = this.props;\n\n    return (\n      <div className='Headportrait-wrap'>\n        <div className='Modify_the_picture'>\n          <span className='close-icon' onClick={handleCancel}>\n            <Icon type=\"close\" />\n          </span>\n          <div className='Modify_head'>\n            {t('Headimage')}\n          </div>\n          <div className='Modify_content'>\n            <p>{t('uploadavatar')}</p>\n            <div className=\"Modify_openimg\">\n              <input type=\"button\" className=\"pass-portrait-filebtn\" name=\"openImgBtn\" id=\"openImgBtn\" value={t('Choosepicture')} />\n              <input\n                type=\"file\"\n                className=\"pass-portrait-file\"\n                accept=\"image/bmp,image/jpeg,image/png\"\n                name=\"file\" id=\"fileImg\"\n                onChange={(e) => { this.handleChange(e) }} />\n              <span className=\"pass-portrait-msg\">{t('SupportPic')}</span>\n            </div>\n\n            {imageUrl && <SelectProfilePic\n              img={this.state.imageUrl}\n              confirm={this.handleconfirm}\n              cancel={this.handleCancel} />}\n\n          </div>\n        </div >\n      </div>\n    );\n  }\n}\nexport default Headportrait;","import React, { Component } from 'react';\nimport { message, Icon, Tooltip } from 'antd';\nimport { withTranslation } from 'react-i18next';\nimport { inject, observer } from 'mobx-react';\nimport { trim, storage, reg } from '../../util/util'\nimport { host, wsget } from '../../ws';\nimport Footer from '../../common/Widget/Footer'\nimport './style.scss';\nimport { get, observable } from 'mobx';\nimport Headportrait from '../../components/Headportrait';\nimport event from '../../util/event';\nimport i18next from 'i18next';\n\n@withTranslation() @inject('login') @observer\nclass Personal extends Component {\n  constructor(props) {\n    super(props);\n    this.nameRef = React.createRef();\n    this.pwdref = React.createRef();\n    this.emailRef = React.createRef();\n\n    this.old_pwdRef = React.createRef();\n    this.new_pwdRef = React.createRef();\n\n    this.state = {\n      visible: false\n    }\n  }\n  @observable nameVisible = false;\n  @observable emailVisible = false;\n  @observable pwdVisible = false;\n\n  componentDidMount() {\n    this.pwdref.current.value = '999999999999';\n    this.props.login.getUser_detail()\n    document.addEventListener('click', this.chengeEmailHide)\n  }\n\n  componentWillUnmount() {\n    document.removeEventListener('click', this.chengeEmailHide)\n  }\n\n  chengeEmailHide = (e) => {\n    if (e.target.nodeName === 'INPUT') {\n      return;\n    }\n    this.emailVisible = false;\n    this.nameVisible = false;\n  }\n\n  //重命名\n  changeName = (e) => {\n    e.nativeEvent.stopImmediatePropagation();\n    if (this.nameVisible) {\n      const { user_detail } = this.props.login;\n      let name = trim(this.nameRef.current.value);\n      if (name === '') {\n        message.error(i18next.t('NicknameEmpty'))\n        return;\n      }\n      this.nameVisible = false;\n      if (name !== get(user_detail, 'nickname')) {\n        if (!reg.nickname.test(name)) {\n          message.error(i18next.t('nicknameValidity'));\n          return;\n        }\n        wsget('user_set_nickname', name, 1).then(() => {\n          this.props.login.getUser_detail();\n          event.emit('setNickname', {\n            type: 'nickname',\n            data: name\n          });\n        })\n      }\n    } else {\n      this.nameVisible = true;\n      if (!this.props.login.firstInit) {\n        this.props.login.getUser_detail(() => {\n          const { user_detail } = this.props.login;\n          if (get(user_detail, 'nickname')) {\n            this.nameRef.current.value = get(user_detail, 'nickname');\n          } else {\n            this.nameRef.current.value = get(user_detail, 'name');\n          }\n        });\n      } else {\n        const { user_detail } = this.props.login;\n        if (get(user_detail, 'nickname')) {\n          this.nameRef.current.value = get(user_detail, 'nickname');\n        } else {\n          this.nameRef.current.value = get(user_detail, 'name');\n        }\n      }\n    }\n  }\n\n  //更换邮箱\n  changeEmail = (e) => {\n    e.nativeEvent.stopImmediatePropagation();\n    let data = storage.get('Z_H_U_DATA');\n    if (this.emailVisible) {\n      const { user_detail } = this.props.login;\n      const email = this.emailRef.current.value;\n      if (!email) {\n        this.emailVisible = false;\n        return;\n      }\n      if (reg.email.test(email)) {\n        this.emailVisible = false;\n        if (email !== get(user_detail, 'email')) {\n          if (!this.props.login.checkEmail(email)) {\n            console.log(email, get(user_detail, 'email'))\n            this.props.login.setEmail(email, () => {\n              data.email = email;\n              storage.set('Z_H_U_DATA', data);\n            })\n          } else {\n            message.error(i18next.t('boundmail'))\n          }\n        }\n      } else {\n        message.error(i18next.t('emailValidity'))\n      }\n    } else {\n      this.emailVisible = true;\n      if (data.email) {\n        this.emailRef.current.value = data.email;\n      } else {\n        this.emailRef.current.value = '';\n      }\n\n    }\n  }\n\n  //更换头像start\n  showModule = () => {\n    this.setState({ visible: true })\n  }\n  hideModal = () => {\n    this.setState({ visible: false })\n  }\n\n  //修改密码\n  preserve = () => {\n    const old_pwd = trim(this.old_pwdRef.current.value);\n    const new_pwd = trim(this.new_pwdRef.current.value);\n    let user = storage.get('user');\n    if (!old_pwd) {\n      message.error(i18next.t('enterOldpwd'));\n      return;\n    }\n    if (!new_pwd) {\n      message.error(i18next.t('enterset'));\n      return;\n    }\n    if (!reg.pwd.test(new_pwd)) {\n      message.error(i18next.t('pwdFormat'));\n      return;\n    }\n    if (old_pwd !== user.pwd) {\n      message.error(i18next.t('oldpwdinc'));\n      return;\n    }\n    if (old_pwd === new_pwd) {\n      message.error(i18next.t('oldnewsame'));\n      return;\n    }\n    wsget('user_repassword', { oldpwd: old_pwd, newpwd: new_pwd }, 1).then(() => {\n      user.pwd = new_pwd;\n      storage.set('user', user);\n    })\n    this.pwdVisible = false;\n  }\n\n  //上传头像\n  upPortrait = (a, id) => {\n    this.props.login.getUser_detail();\n    event.emit('setNickname', {\n      type: 'portrait',\n      data: id\n    });\n  }\n\n\n  render() {\n    const { t } = this.props;\n    const { nameVisible, emailVisible, pwdVisible } = this;\n    const { visible } = this.state;\n    const { user_detail } = this.props.login;\n    const ref = /(.{1}).+(.{2}@.+)/g;\n\n    return (\n      <div className='personal_main'>\n        <div className='personal_content'>\n          <div className='p-content'>\n            <div className='content-header'>\n              <h2>{t('accountmanagement')}</h2>\n              <div className='plate-1'>\n                <div className='subhead'>\n                  <h4>{t('Personalinformation')}</h4>\n                </div>\n                <div className='headportrait'>\n                  <div className='left'>\n                    <span>{t('HeadPortrait')}</span>\n                  </div>\n                  <div className='middle'>\n                    {get(user_detail, 'profile') ? <img alt='profile' src={`${host()}/uf/s/${get(user_detail, 'profile').id}/${get(user_detail, 'id')}`} /> : <span><Icon type=\"user\" /></span>}\n                  </div>\n                  <div className='right' onClick={this.showModule}>\n                    <span>{t('ChangetheAvatar')}</span>\n                  </div>\n                </div>\n                <div className='nickname'>\n                  <div className='left'>\n                    <span>{t('Nickname')}</span>\n                  </div>\n                  <div className='middle'>\n                    <Tooltip\n                      placement=\"topLeft\"\n                      overlayClassName='tooltip'\n                      trigger='focus'\n                      title={t('pwdreg')}>\n                      <input\n                        style={{ display: nameVisible ? 'block' : 'none' }}\n                        spellCheck={false}\n                        type=\"text\"\n                        maxLength={50}\n                        ref={this.nameRef}\n                        placeholder={t('SetNickname')} />\n                    </Tooltip>\n                    <p className='staticname ellipsis' style={{ display: nameVisible ? 'none' : 'block' }}>{user_detail.nickname ? user_detail.nickname : user_detail.name}</p>\n                  </div>\n                  <div className='right' onClick={this.changeName}>\n                    <span>{nameVisible ? t('Determine') : t('ChangeNickname')}</span>\n                  </div>\n                </div>\n              </div>\n              <div className='plate-2'>\n                <div className='subhead'>\n                  <h4>{t('accountinformation')}</h4>\n                </div>\n                <div className='nickname'>\n                  <div className='left'>\n                    <span>{t('UserName')}</span>\n                  </div>\n                  <div className='middle'>\n                    <p className='staticname ellipsis'>{storage.get('Z_H_U_DATA').name}</p>\n                  </div>\n                </div>\n                <div className='headportrait'>\n                  <div className='left'>\n                    <span>{t('mailbox')}</span>\n                  </div>\n                  <div className='middle'>\n                    <input\n                      style={{ display: emailVisible ? 'block' : 'none' }}\n                      spellCheck={false}\n                      type=\"email\"\n                      ref={this.emailRef}\n                      placeholder={t('enterEmail')} />\n                    <p\n                      style={{ display: emailVisible ? 'none' : 'block' }}>\n                      {get(user_detail, 'email') ? get(user_detail, 'email').replace(ref, \"$1****$2\") : '还未绑定邮箱'}\n                    </p>\n                  </div>\n                  <div className='right' onClick={this.changeEmail}>\n                    <span>{emailVisible ? t('Determine') : t('Changingmailbox')}</span>\n                  </div>\n                </div>\n                <div className='nickname'>\n                  <div className='left'>\n                    <span>{t('Password')}</span>\n                  </div>\n                  <div className='middle'>\n                    <input className='pwd' type=\"password\" ref={this.pwdref} readOnly={true} />\n                  </div>\n                  <div className='right' onClick={() => { this.pwdVisible = true; }}>\n                    <span>{t('Changepassword')}</span>\n                  </div>\n                </div>\n              </div>\n              <div className='plate-3'>\n                {/* <div className='subhead'>\n                  <h4>{t('Thirdpartyaccountbinding')}</h4>\n                </div>\n                <div className='third-party'></div> */}\n              </div>\n            </div>\n          </div>\n        </div>\n\n        {visible && <Headportrait\n          userId={user_detail.id}\n          handleCancel={this.hideModal}\n          callback={this.upPortrait} />}\n\n        {pwdVisible && <div className='changepwd-inner'>\n          <div className='changepwd-content'>\n            <span className='close_icon' onClick={() => { this.pwdVisible = false; }}>\n              <Icon type='close' />\n            </span>\n            <div className='changepwd-head'>\n              <h4>{t('ChangePwd')}</h4>\n            </div>\n            <div className='changepwd-bd'>\n              <p className='pwd_item'>\n                <label className='pwd_label' htmlFor='old_pwd'>{t('Oldpwd')}</label>\n                <input\n                  id='old_pwd'\n                  className='pwd_input'\n                  type='password'\n                  ref={this.old_pwdRef}\n                  placeholder={t(\"enterOldpwd\")} />\n              </p>\n              <p className='pwd_item'>\n                <label className='pwd_label' htmlFor='new_pwd'>{t('NewPwd')}</label>\n                <Tooltip placement=\"topRight\" overlayClassName='tooltip' trigger='focus' title={t('pwdreg')}>\n                  <input\n                    id='new_pwd'\n                    className='pwd_input'\n                    type='password'\n                    ref={this.new_pwdRef}\n                    placeholder={t('enterNewpwd')} />\n                </Tooltip>\n              </p>\n            </div>\n            <div className='changepwd-ft'>\n              <span className='changepwd-btn' onClick={this.preserve}>{t('Preservation')}</span>\n            </div>\n          </div>\n        </div>}\n\n        <Footer />\n      </div>\n    );\n  }\n}\nexport default Personal;\n"],"sourceRoot":""}