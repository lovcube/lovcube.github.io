{"version":3,"sources":["common/VideoPlayer/index.js","common/ImageGallery/index.js"],"names":["VideoPlayer","withTranslation","state","inner","load","resize","window","innerWidth","setState","this","player","subscribeToStateChange","handleStateChange","bind","addEventListener","removeEventListener","Props","props","src","video","handleError","message","error","t","readyState","poster","id","className","type","style","fontSize","display","spin","ref","playsInline","fluid","preload","autoPlay","height","innerHeight","width","position","Component","videoReg","ImageGallery","observer","zoom","e","test","ext","deltaY","scale","times","cptShow","cpt","cptModle","inputRef","current","value","cptHide","addcpt","val","blur","React","createRef","imgRef","X","Y","url","moving","lastX","lastY","onmouseup","onMouseUp","onmousemove","onMouseMove","imgLoad","getFile","file_s","_","img","isUnmount","w","h","file_b","offsetWidth","offsetHeight","stopPropagation","preventDefault","filg","onMove","dx","clientX","dy","clientY","ViEl","closeDialog","onPiece","nextPage","alt","onClick","onWheel","up","onMouseDown","transform","color","cptRef","i18next","title","visible","onOk","onCancel","getContainer","centered","maxLength","autoFocus","placeholder","observable"],"mappings":"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","file":"static/js/5.eb1364a0.chunk.js","sourcesContent":["import React, { Component } from \"react\";\nimport { Icon, message } from \"antd\";\nimport { Player, BigPlayButton } from \"video-react\";\nimport { withTranslation } from \"react-i18next\";\n\n@withTranslation()\nclass VideoPlayer extends Component {\n  state = {\n    inner: false,\n    load: false,\n  };\n  componentDidMount() {\n    this.resize();\n    this.player.subscribeToStateChange(this.handleStateChange.bind(this));\n    window.addEventListener(\"resize\", this.resize);\n  }\n\n  componentWillUnmount(){\n    window.removeEventListener(\"resize\", this.resize);\n  }\n\n  UNSAFE_componentWillReceiveProps(Props) {\n    if (this.props.src !== Props.src) {\n      this.setState({ load: false });\n    }\n  }\n\n  resize = () => {\n    if (window.innerWidth < 900) {\n      if (!this.state.inner) {\n        this.setState({ inner: true });\n      }\n    } else {\n      if (this.state.inner) {\n        this.setState({ inner: false });\n      }\n    }\n  };\n\n  handleStateChange(state) {\n    this.player.video.handleError = () => {\n      message.error(this.props.t(\"Videofailed\"));\n    };\n    if (this.state.load) {\n      return;\n    }\n    if (state.readyState === 4) {\n      this.setState({\n        load: true,\n      });\n    }\n  }\n  render() {\n    const { poster, src } = this.props;\n    return (\n      <div id=\"VIDEOBOX\">\n        <Icon\n          className=\"icon-load\"\n          type=\"loading\"\n          style={{\n            fontSize: 70,\n            display: `${this.state.load ? \"none\" : \"block\"}`,\n          }}\n          spin\n        />\n        <Player\n          ref={(player) => {\n            this.player = player;\n          }}\n          playsInline\n          fluid={false}\n          poster={poster}\n          src={src}\n          preload=\"auto\"\n          autoPlay\n          height={this.state.inner ? window.innerHeight / 2 : 600}\n          width={this.state.inner ? window.innerHeight : 900}\n          className=\"p_video\"\n        >\n          <BigPlayButton position=\"center\" />\n        </Player>\n      </div>\n    );\n  }\n}\n\nexport default VideoPlayer;\n","import React from \"react\";\nimport { observable } from \"mobx\";\nimport { getFile, imgLoad } from \"../../util/index\";\nimport { Icon, Modal } from \"antd\";\nimport VideoPlayer from \"../../common/VideoPlayer\";\nimport { observer } from \"mobx-react\";\nimport i18next from \"i18next\";\nimport './style.scss';\n\nconst videoReg = /(mp4|avi|rmvb|rm|wmv|mov|mpg|mpeg|flv|mkv|3gp|webm|ts|m3u8)$/;\n\n@observer\nclass ImageGallery extends React.Component {\n  constructor(props) {\n    super(props);\n    this.inputRef = React.createRef();\n    this.imgRef = React.createRef();\n    this.state = {\n      load: false,\n      X: 0,\n      Y: 0,\n      url: \"\",\n      cptModle: false,\n    };\n    this.moving = false;\n    this.lastX = null;\n    this.lastY = null;\n    this.times = 1;\n    window.onmouseup = (e) => {\n      this.onMouseUp(e);\n    };\n    window.onmousemove = (e) => {\n      this.onMouseMove(e);\n    };\n  }\n  @observable scale = 1;\n  @observable filg = false;\n  @observable width = 0;\n  @observable height = 0;\n\n  componentDidMount() {\n    const { id } = this.props;\n\n    imgLoad(getFile.file_s(id), (_, img) => {\n      if (!this.isUnmount) {\n        const w = img.width / 2;\n        const h = img.height / 2;\n        this.setState({ X: -w, Y: -h });\n      }\n    });\n    imgLoad(getFile.file_b(id), (url) => {\n      if (!this.isUnmount) {\n        this.setState({ url, load: true }, () => {\n          let w = this.imgRef.current.offsetWidth / 2;\n          let h = this.imgRef.current.offsetHeight / 2;\n          this.setState({ X: -w, Y: -h });\n        });\n      }\n    });\n  }\n\n  componentWillUnmount() {\n    this.isUnmount = true;\n  }\n\n  UNSAFE_componentWillReceiveProps(Props) {\n    if (this.props.id !== Props.id) {\n      this.scale = 1;\n      this.times = 1;\n      this.setState({ load: false });\n      imgLoad(getFile.file_s(Props.id), (_, img) => {\n        if (!this.isUnmount) {\n          const w = img.width / 2;\n          const h = img.height / 2;\n          this.setState({ X: -w, Y: -h });\n        }\n      });\n      imgLoad(getFile.file_b(Props.id), (url) => {\n        if (!this.isUnmount) {\n          this.setState({ url, load: true }, () => {\n            let w = this.imgRef.current.offsetWidth / 2;\n            let h = this.imgRef.current.offsetHeight / 2;\n            this.setState({ X: -w, Y: -h });\n          });\n        }\n      });\n    }\n  }\n\n  onMouseDown(e) {\n    if (!videoReg.test(this.props.ext)) {\n      e.stopPropagation();\n      e.preventDefault();\n      this.filg = true;\n      this.moving = true;\n    }\n  }\n\n  onMouseUp() {\n    this.filg = false;\n    this.moving = false;\n    this.lastX = null;\n    this.lastY = null;\n  }\n\n  onMouseMove(e) {\n    this.moving && this.onMove(e);\n  }\n\n  onMove(e) {\n    if (this.lastX && this.lastY) {\n      let dx = e.clientX - this.lastX;\n      let dy = e.clientY - this.lastY;\n      this.setState({\n        X: this.state.X + dx * this.times,\n        Y: this.state.Y + dy * this.times,\n      });\n    }\n    this.lastX = e.clientX;\n    this.lastY = e.clientY;\n  }\n\n  zoom = (e) => {\n    if (!videoReg.test(this.props.ext)) {\n      if (e.deltaY > 0) {\n        if (this.scale >= 0.25) {\n          this.scale -= 0.05;\n        }\n      } else {\n        if (this.scale <= 4) {\n          this.scale += 0.05;\n        }\n      }\n      if (this.scale < 1) {\n        this.times = 1 - this.scale + 1;\n      } else {\n        this.times = 1;\n      }\n    }\n  };\n\n  cptShow = () => {\n    const { cpt } = this.props;\n    this.setState({ cptModle: true });\n    this.inputRef.current.value = cpt || \"\";\n  };\n\n  cptHide = () => {\n    this.setState({ cptModle: false });\n    this.inputRef.current.value = \"\";\n  }\n\n  addcpt = (val) => {\n    this.cptHide();\n    let cpt = this.props.cpt || '';\n    if (cpt === val) {\n      return;\n    }\n    this.props.blur(val);\n  }\n\n  render() {\n    const { id, cpt, ext, closeDialog, onPiece, nextPage, blur } = this.props;\n    let ViEl;\n    if (videoReg.test(ext)) {\n      ViEl = (\n        <VideoPlayer\n          poster={getFile.file_s(id)}\n          src={getFile.file_b(id)}\n        />\n      );\n    } else {\n      ViEl = (\n        <img\n          src={this.state.load ? this.state.url : getFile.file_s(id)}\n          alt={id}\n        />\n      );\n    }\n    return (\n      <div className=\"dialog treeNodeUnselectable\">\n        <span className=\"close-dialog\" onClick={closeDialog}>\n          <Icon type=\"close\" />\n        </span>\n        <div\n          id=\"imgbody\"\n          className=\"dialog-boby\"\n          onWheel={this.zoom}\n          onMouseUp={this.up}\n        >\n          <div\n            id=\"imgbox\"\n            className=\"img-wrap-clear\"\n            ref={this.imgRef}\n            onMouseDown={(e) => {\n              this.onMouseDown(e);\n            }}\n            style={{\n              transform: videoReg.test(ext)\n                ? `scale(${this.scale}) translateX(-50%)translateY(-50%)`\n                : `scale(${this.scale}) translateX(${this.state.X}px)translateY(${this.state.Y}px)`,\n            }}\n          >\n            {!videoReg.test(ext) && !this.state.load && (\n              <Icon\n                className=\"icon-load\"\n                type=\"loading\"\n                style={{\n                  fontSize: 70,\n                  color: \"#fff\",\n                }}\n                spin\n              />\n            )}\n            {ViEl}\n          </div>\n          <div\n            className={`onPiece ${this.filg ? \"hide\" : \"\"}`}\n            onClick={onPiece}\n          >\n            <span className=\"pre-arrow\">\n              <Icon type=\"left\" />\n            </span>\n          </div>\n          <div\n            className={`nextPage ${this.filg ? \"hide2\" : \"\"}`}\n            onClick={nextPage}\n          >\n            <span className=\"next-arrow\">\n              <Icon type=\"right\" />\n            </span>\n          </div>\n\n          {blur && (\n            <div className={`operation ${this.filg ? \"hide3\" : \"\"}`}>\n              <span\n                ref={this.cptRef}\n                className=\"ellipsis\"\n                style={{ color: \"#FFF\" }}\n                onClick={this.cptShow}\n              >\n                {cpt\n                  ? cpt\n                  : `${i18next.t(\"adddescription\")}...`}\n              </span>\n            </div>\n          )}\n        </div>\n\n        <Modal\n          title={i18next.t(\"AddCpt\")}\n          visible={this.state.cptModle}\n          onOk={() => { this.addcpt(this.inputRef.current.value) }}\n          onCancel={this.cptHide}\n          getContainer={false}\n          centered\n        >\n          <div className=\"cpt-inner-input\">\n            <input\n              type=\"text\"\n              ref={this.inputRef}\n              maxLength={100}\n              autoFocus\n              placeholder={i18next.t(\"enterdescription\")}\n            />\n          </div>\n        </Modal>\n      </div>\n    );\n  }\n}\n\nexport default ImageGallery;\n"],"sourceRoot":""}