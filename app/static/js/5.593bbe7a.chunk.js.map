{"version":3,"sources":["common/VideoPlayer/index.js","components/Home/BigImg.js"],"names":["VideoPlayer","withTranslation","state","inner","load","resize","window","innerWidth","setState","this","player","subscribeToStateChange","handleStateChange","bind","addEventListener","removeEventListener","Props","props","src","video","handleError","message","error","t","readyState","poster","id","className","type","style","fontSize","display","spin","ref","playsInline","fluid","preload","autoPlay","height","innerHeight","width","position","Component","videoReg","BigimgCpt","observer","zoom","e","test","imgfile","ext","deltaY","scale","times","cptShow","cptModle","inputRef","current","value","get","cptHide","addcpt","val","blur","React","createRef","imgRef","X","Y","url","moving","lastX","lastY","onmouseup","onMouseUp","onmousemove","onMouseMove","imgLoad","getFile","file_s","_","img","isUnmount","w","h","file_b","offsetWidth","offsetHeight","stopPropagation","preventDefault","filg","onMove","dx","clientX","dy","clientY","ViEl","closeDialog","onPiece","nextPage","alt","onClick","onWheel","up","onMouseDown","transform","color","cptRef","i18next","title","visible","onOk","onCancel","getContainer","centered","maxLength","autoFocus","placeholder","observable"],"mappings":"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","file":"static/js/5.593bbe7a.chunk.js","sourcesContent":["import React, { Component } from \"react\";\nimport { Icon, message } from \"antd\";\nimport { Player, BigPlayButton } from \"video-react\";\nimport { withTranslation } from \"react-i18next\";\n\n@withTranslation()\nclass VideoPlayer extends Component {\n  state = {\n    inner: false,\n    load: false,\n  };\n  componentDidMount() {\n    this.resize();\n    this.player.subscribeToStateChange(this.handleStateChange.bind(this));\n    window.addEventListener(\"resize\", this.resize);\n  }\n\n  componentWillUnmount(){\n    window.removeEventListener(\"resize\", this.resize);\n  }\n\n  UNSAFE_componentWillReceiveProps(Props) {\n    if (this.props.src !== Props.src) {\n      this.setState({ load: false });\n    }\n  }\n\n  resize = () => {\n    if (window.innerWidth < 900) {\n      if (!this.state.inner) {\n        this.setState({ inner: true });\n      }\n    } else {\n      if (this.state.inner) {\n        this.setState({ inner: false });\n      }\n    }\n  };\n\n  handleStateChange(state) {\n    this.player.video.handleError = () => {\n      message.error(this.props.t(\"Videofailed\"));\n    };\n    if (this.state.load) {\n      return;\n    }\n    if (state.readyState === 4) {\n      this.setState({\n        load: true,\n      });\n    }\n  }\n  render() {\n    const { poster, src } = this.props;\n    return (\n      <div id=\"VIDEOBOX\">\n        <Icon\n          className=\"icon-load\"\n          type=\"loading\"\n          style={{\n            fontSize: 70,\n            display: `${this.state.load ? \"none\" : \"block\"}`,\n          }}\n          spin\n        />\n        <Player\n          ref={(player) => {\n            this.player = player;\n          }}\n          playsInline\n          fluid={false}\n          poster={poster}\n          src={src}\n          preload=\"auto\"\n          autoPlay\n          height={this.state.inner ? window.innerHeight / 2 : 600}\n          width={this.state.inner ? window.innerHeight : 900}\n          className=\"p_video\"\n        >\n          <BigPlayButton position=\"center\" />\n        </Player>\n      </div>\n    );\n  }\n}\n\nexport default VideoPlayer;\n","import React from \"react\";\nimport \"../../common/BigimgCpt.js/style.scss\";\nimport { observable, get } from \"mobx\";\nimport { getFile, imgLoad } from \"../../util/util\";\nimport { Icon, Modal } from \"antd\";\nimport VideoPlayer from \"../../common/VideoPlayer\";\nimport { observer } from \"mobx-react\";\nimport i18next from \"i18next\";\n\nconst videoReg = /(mp4|avi|rmvb|rm|wmv|mov|mpg|mpeg|flv|mkv|3gp|webm|ts|m3u8)$/;\n\n@observer\nclass BigimgCpt extends React.Component {\n  constructor(props) {\n    super(props);\n    this.inputRef = React.createRef();\n    this.imgRef = React.createRef();\n    this.state = {\n      load: false,\n      X: 0,\n      Y: 0,\n      url: \"\",\n      cptModle: false,\n    };\n    this.moving = false;\n    this.lastX = null;\n    this.lastY = null;\n    this.times = 1;\n    window.onmouseup = (e) => {\n      this.onMouseUp(e);\n    };\n    window.onmousemove = (e) => {\n      this.onMouseMove(e);\n    };\n  }\n  @observable scale = 1;\n  @observable filg = false;\n  @observable width = 0;\n  @observable height = 0;\n\n  componentDidMount() {\n    const { imgfile } = this.props;\n    \n    imgLoad(getFile.file_s(imgfile.id), (_, img) => {\n      if (!this.isUnmount) {\n        const w = img.width / 2;\n        const h = img.height / 2;\n        this.setState({ X: -w, Y: -h });\n      }\n    });\n    imgLoad(getFile.file_b(imgfile.id), (url) => {\n      if (!this.isUnmount) {\n        this.setState({ url, load: true }, () => {\n          let w = this.imgRef.current.offsetWidth / 2;\n          let h = this.imgRef.current.offsetHeight / 2;\n          this.setState({ X: -w, Y: -h });\n        });\n      }\n    });\n  }\n\n  componentWillUnmount() {\n    this.isUnmount = true;\n  }\n\n  UNSAFE_componentWillReceiveProps(Props) {\n    if (this.props.imgfile.id !== Props.imgfile.id) {\n      this.scale = 1;\n      this.times = 1;\n      this.setState({ load: false });\n      imgLoad(getFile.file_s(Props.imgfile.id), (_, img) => {\n        if (!this.isUnmount) {\n          const w = img.width / 2;\n          const h = img.height / 2;\n          this.setState({ X: -w, Y: -h });\n        }\n      });\n      imgLoad(getFile.file_b(Props.imgfile.id), (url) => {\n        if (!this.isUnmount) {\n          this.setState({ url, load: true }, () => {\n            let w = this.imgRef.current.offsetWidth / 2;\n            let h = this.imgRef.current.offsetHeight / 2;\n            this.setState({ X: -w, Y: -h });\n          });\n        }\n      });\n    }\n  }\n\n  onMouseDown(e) {\n    if (!videoReg.test(this.props.imgfile.ext)) {\n      e.stopPropagation();\n      e.preventDefault();\n      this.filg = true;\n      this.moving = true;\n    }\n  }\n\n  onMouseUp() {\n    this.filg = false;\n    this.moving = false;\n    this.lastX = null;\n    this.lastY = null;\n  }\n\n  onMouseMove(e) {\n    this.moving && this.onMove(e);\n  }\n\n  onMove(e) {\n    if (this.lastX && this.lastY) {\n      let dx = e.clientX - this.lastX;\n      let dy = e.clientY - this.lastY;\n      this.setState({\n        X: this.state.X + dx * this.times,\n        Y: this.state.Y + dy * this.times,\n      });\n    }\n    this.lastX = e.clientX;\n    this.lastY = e.clientY;\n  }\n\n  zoom = (e) => {\n    if (!videoReg.test(this.props.imgfile.ext)) {\n      if (e.deltaY > 0) {\n        if (this.scale >= 0.25) {\n          this.scale -= 0.05;\n        }\n      } else {\n        if (this.scale <= 4) {\n          this.scale += 0.05;\n        }\n      }\n      if (this.scale < 1) {\n        this.times = 1 - this.scale + 1;\n      } else {\n        this.times = 1;\n      }\n    }\n  };\n\n  cptShow = () => {\n    const { imgfile } = this.props;\n    this.setState({ cptModle: true });\n    this.inputRef.current.value = get(imgfile, \"cpt\") || \"\";\n  };\n\n  cptHide = () => {\n    this.setState({ cptModle: false });\n    this.inputRef.current.value = \"\";\n  }\n\n  addcpt = (val) => {\n    this.cptHide();\n    let cpt = get(this.props.imgfile, 'cpt') || '';\n    if (cpt === val) {\n      return;\n    }\n    this.props.blur(val);\n  }\n\n  render() {\n    const { closeDialog, imgfile, onPiece, nextPage, blur } = this.props;\n    let ViEl;\n    if (videoReg.test(imgfile.ext)) {\n      ViEl = (\n        <VideoPlayer\n          poster={getFile.file_s(imgfile.id)}\n          src={getFile.file_b(imgfile.id)}\n        />\n      );\n    } else {\n      ViEl = (\n        <img\n          src={this.state.load ? this.state.url : getFile.file_s(imgfile.id)}\n          alt={imgfile.id}\n        />\n      );\n    }\n    return (\n      <div className=\"dialog treeNodeUnselectable\">\n        <span className=\"close-dialog\" onClick={closeDialog}>\n          <Icon type=\"close\" />\n        </span>\n        <div\n          id=\"imgbody\"\n          className=\"dialog-boby\"\n          onWheel={this.zoom}\n          onMouseUp={this.up}\n        >\n          <div\n            id=\"imgbox\"\n            className=\"img-wrap-clear\"\n            ref={this.imgRef}\n            onMouseDown={(e) => {\n              this.onMouseDown(e);\n            }}\n            style={{\n              transform: videoReg.test(imgfile.ext)\n                ? `scale(${this.scale}) translateX(-50%)translateY(-50%)`\n                : `scale(${this.scale}) translateX(${this.state.X}px)translateY(${this.state.Y}px)`,\n            }}\n          >\n            {!videoReg.test(imgfile.ext) && !this.state.load && (\n              <Icon\n                className=\"icon-load\"\n                type=\"loading\"\n                style={{\n                  fontSize: 70,\n                  color: \"#fff\",\n                }}\n                spin\n              />\n            )}\n            {ViEl}\n          </div>\n          <div\n            className={`onPiece ${this.filg ? \"hide\" : \"\"}`}\n            onClick={onPiece}\n          >\n            <span className=\"pre-arrow\">\n              <Icon type=\"left\" />\n            </span>\n          </div>\n          <div\n            className={`nextPage ${this.filg ? \"hide2\" : \"\"}`}\n            onClick={nextPage}\n          >\n            <span className=\"next-arrow\">\n              <Icon type=\"right\" />\n            </span>\n          </div>\n\n          {blur && (\n            <div className={`operation ${this.filg ? \"hide3\" : \"\"}`}>\n              <span\n                ref={this.cptRef}\n                className=\"ellipsis\"\n                style={\n                  get(imgfile, \"cpt\") ? { color: \"#FFF\" } : { color: \"#fff\" }\n                }\n                onClick={this.cptShow}\n              >\n                {get(imgfile, \"cpt\")\n                  ? get(imgfile, \"cpt\")\n                  : `${i18next.t(\"adddescription\")}...`}\n              </span>\n            </div>\n          )}\n        </div>\n\n        <Modal\n          title={i18next.t(\"AddCpt\")}\n          visible={this.state.cptModle}\n          onOk={() => { this.addcpt(this.inputRef.current.value) }}\n          onCancel={this.cptHide}\n          getContainer={false}\n          centered\n        >\n          <div className=\"cpt-inner-input\">\n            <input\n              type=\"text\"\n              ref={this.inputRef}\n              maxLength={100}\n              autoFocus\n              placeholder={i18next.t(\"enterdescription\")}\n            />\n          </div>\n        </Modal>\n      </div>\n    );\n  }\n}\n\nexport default BigimgCpt;\n"],"sourceRoot":""}